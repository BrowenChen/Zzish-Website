extends profile_layout

block javascript
	script()

block content


	div.row

		hr

		div.medium-3.columns
			p

		div.medium-6.columns
			
			h1(align="center") Dashboard
			

		div.medium-3.columns
			img(src="/img/icons/add.png" height="20" width="20" align="right" style="margin-top: 15px; ")#settings_button

		hr

	div.row#settings_box(style="display: none; ")
		div.small-10.small-centered.columns.settings
			div.row(style="background-color: #6B2967; border-radius: 20px 20px 0px 0px; ")
				div.medium-3.columns
					p
				div.medium-6.columns					
					h3(align="center" style="color: #FFFFFF;") Create New Graph
				div.medium-3.columns
					img(src="/img/icons/close.png" height="20" width="20" align="right" style="margin-top: 5px; margin-right: 5px;")#settings_button_close


			div.row(style="background-color:#E9D9FA; height:170px; border-radius:0px 0px 20px 20px ")#settings_p1
				p <br>

				div.medium-1.columns
					img(src="/img/icons/leftarrow.png" height="40" width="40" align="right" style="margin-left: 15px; margin-top: 15px;" onclick="prevSettings();")#settings_prev

				div.medium-5.columns
					p Select topic you would like to analayse

					select(onchange="onSelectTopics('topicSelect')")#topicSelect
						option(value="purchases") purchases
						option(value="kpi") KPIs
						option(value="activities") Activities
						option(value="actions") Actions

				div.medium-5.columns
					p Info 
				

				div.medium-1.columns
					img(src="/img/icons/rightarrow.png" height="40" width="40" align="right" style="margin-right: 15px; margin-top: 15px;" onclick="nextSettings();")#settingsTopicSelectNext

			div.row(style="background-color:#E9D9FA;  border-radius:0px 0px 20px 20px; height:170px; display: none;")#settings_p2
				p <br>

				div.medium-1.columns
					img(src="/img/icons/leftarrow.png" height="40" width="40" align="right" style="margin-left: 15px; margin-top: 15px;" onclick="prevSettings();")#settings_prev

				div.medium-5.columns
					p Welcome to graph editor, in order to add a new graph we will take you through a few steps to fully customise your experience. First select a graph type.

				div.medium-5.columns
					img(src="/img/icons/bar_chart.png" height="75" width="75" align="right" style="margin-right: 15px; margin-top: 15px; margin-bottom: 15px;" onclick="setGraph('bar', 'barChart')")#barChart
					img(src="/img/icons/line_chart.png" height="75" width="75" align="right" style="margin-right: 15px; margin-top: 15px; margin-bottom: 15px;" onclick="setGraph('line', 'lineChart')")#lineChart
					img(src="/img/icons/pie_chart.png" height="75" width="75" align="right" style="margin-right: 15px; margin-top: 15px; margin-bottom: 15px;" onclick="setGraph('pie', 'pieChart')")#pieChart
					img(src="/img/icons/pie_chart.png" height="75" width="75" align="right" style="margin-right: 15px; margin-top: 15px; margin-bottom: 15px;" onclick="setGraph('number', 'numberChart')")#numberChart

				div.medium-1.columns
					img(src="/img/icons/rightarrow.png" height="40" width="40" align="right" style="margin-right: 15px; margin-top: 15px;" onclick="nextSettings();")



			



			div.row(style="background-color:#E9D9FA;  border-radius:0px 0px 20px 20px; display: none; height:170px;")#settings_p3
				p <br>

				div.medium-1.columns
					img(src="/img/icons/leftarrow.png" height="40" width="40" align="right" style="margin-left: 15px; margin-top: 15px;" onclick="prevSettings();")

				div.medium-5.columns
					p In this section you chose what you would like to the X and Y axis to represent for your chosen catagory

				div.medium-5.columns
					input(type="hidden")#settingsGraphId

					div.row(style="display: none;")#xaxisDisplay
						div.small-3.columns
							label(for="right-label" class="right inline") X axis
						div.small-9.columns
							select(name="xaxis")#xaxis
							
					div.row(style="display: none;")#yaxisDisplay
						div.small-3.columns
							label(for="right-label" class="right inline") Y axis
						div.small-9.columns
							select(name="yaxis")#yaxis

					div.row(style="display: none;")#kpi_variableDisplay
						div.small-3.columns
							label(for="right-label" class="right inline") Variable
						div.small-9.columns
							select(name="kpi_variable")#kpi_variable
						

				div.medium-1.columns
					img(src="/img/icons/rightarrow.png" height="40" width="40" align="right" style="margin-right: 15px; margin-top: 15px;" onclick="nextSettings();")



			div.row(style="background-color:#E9D9FA;  border-radius:0px 0px 20px 20px; display: none; height:170px;")#settings_p4
				p <br>

				div.medium-1.columns
					img(src="/img/icons/leftarrow.png" height="40" width="40" align="right" style="margin-left: 15px; margin-top: 15px;" onclick="prevSettings();")

				div.medium-4.columns
					p bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla bla 

				div.medium-6.columns
					div.row
						div.small-4.columns
								label(for="right-label" class="right inline") Start Date
						div.medium-8.columns
							div.small-6.columns
								select#startmonth
									option(value="January") January
									option(value="Febuary") Febuary
									option(value="March") March
									option(value="May") May
									option(value="June") June
									option(value="July") July
									option(value="August") August
									option(value="September") September
									option(value="October") October
									option(value="November") November
									option(value="December") December
							div.medium-6.columns
									select#startyear
										option(value="2014") 2014
										option(value="2013") 2013
										option(value="2012") 2012
										option(value="2011") 2011

					div.row
						div.small-4.columns
								label(for="right-label" class="right inline") End Date
						div.medium-8.columns
							div.small-6.columns
								select#endmonth
									option(value="January") January
									option(value="Febuary") Febuary
									option(value="March") March
									option(value="May") May
									option(value="June") June
									option(value="July") July
									option(value="August") August
									option(value="September") September
									option(value="October") October
									option(value="November") November
									option(value="December") December
							div.medium-6.columns
									select#endyear
										option(value="2014") 2014
										option(value="2013") 2013
										option(value="2012") 2012
										option(value="2011") 2011


					
				div.medium-1.columns
					img(src="/img/icons/rightarrow.png" height="40" width="40" align="right" style="margin-right: 15px; margin-top: 15px;" onclick="nextSettings();")#finalNext

			div.row(style="background-color:#E9D9FA;  border-radius:0px 0px 20px 20px; display: none; height:170px;")#settings_p5
				div.medium-1.columns
					img(src="/img/icons/leftarrow.png" height="40" width="40" align="right" style="margin-left: 15px; margin-top: 15px;" onclick="prevSettings();")

				div.medium-10.columns
					div.row
						h3(align="center") Final Graph Summary



						div.medium-4.columns
							div.row
								p Start Date: <span id="s_start"></span>
								p End Date: <span id="s_end"></span>

						div.medium-4.columns
							div.row
								p Topic: <span id="s_topic"></span>
								p Graph Style: <span id="s_graph"></span>

						div.medium-4.columns
							div.row#variabledisplay
								p variable: <span id="s_v"></span>
								
							div.row#xydisplay
								p x-axis: <span id="s_x"></span>
								p y-axis: <span id="s_y"></span>

				
					
				div.medium-1.columns
					p &nbsp;
						
	p &nbsp;
				
						
	p &nbsp;




	div.row

		div.medium-6.columns
			each prop in properties
				if(prop.side == 0)
					case prop.type
						when "pie"
							div.row.graph(style="margin-right: 10px; margin-left: 10px;")
								div.row
									div.medium-2.columns
										p
									div.medium-8.columns
										h3(align="center") #{prop.title}
									div.medium-2.columns
										img(onclick="settings('#{prop.id}')" src="/img/icons/settings.png" height="20" width="20" align="right")

								div.row
									center
										canvas(height="300" width="300" id="#{prop.id}")

									p(style="margin: 15px;") This graph is showing data from #{prop.start} to #{prop.end}
							p &nbsp;


						when "bar"
							div.row.graph(style="margin-right: 10px; margin-left: 10px;")
								div.row
									div.medium-2.columns
										p
									div.medium-8.columns
										h3(align="center") #{prop.title}
									div.medium-2.columns
										img(onclick="settings(#{prop.id})" src="/img/icons/settings.png" height="20" width="20" align="right")

								div.row
									center
										canvas(height="300" width="450" id="#{prop.id}")

									p(style="margin: 15px;") This graph is showing data from #{prop.start} to #{prop.end}
							p &nbsp;
					
						when "line"
							div.row.graph(style="margin-right: 10px; margin-left: 10px;")
								div.row
									div.medium-2.columns
										p
									div.medium-8.columns
										h3(align="center") #{prop.title}
									div.medium-2.columns
										img(onclick="settings(#{prop.id})" src="/img/icons/settings.png" height="20" width="20" align="right")

								div.row
									center
										canvas(height="300" width="450" id="#{prop.id}")

									p(style="margin: 15px;") This graph is showing data from #{prop.start} to #{prop.end}

									

							p &nbsp;

		div.medium-6.columns
			each prop in properties
				if(prop.side == 1)
					case prop.type
						when "pie"
							div.row.graph(style="margin-right: 10px; margin-left: 10px;")
								
								div.row
									div.medium-2.columns
										p
									div.medium-8.columns
										h3(align="center") #{prop.title}
									div.medium-2.columns
										img(onclick="settings(#{prop.id})" src="/img/icons/settings.png" height="20" width="20" align="right")

								div.row
									center
										canvas(height="300" width="300" id="#{prop.id}")

									p(style="margin: 15px;") This graph is showing data from #{prop.start} to #{prop.end}
							p &nbsp;

						when "bar"
							div.row.graph(style="margin-right: 10px; margin-left: 10px;")
								div.row
									div.medium-2.columns
										p
									div.medium-8.columns
										h3(align="center") #{prop.title}
									div.medium-2.columns
										img(onclick="settings(#{prop.id})" src="/img/icons/settings.png" height="20" width="20" align="right")

								div.row
									center
										canvas(height="300" width="450" id="#{prop.id}")

									p(style="margin: 15px;") This graph is showing data from #{prop.start} to #{prop.end}
							p &nbsp;
					
						when "line"
							div.row.graph(style="margin-right: 10px; margin-left: 10px;")
								div.row
									div.medium-2.columns
										p
									div.medium-8.columns
										h3(align="center") #{prop.title}
									div.medium-2.columns
										img(onclick="settings(#{prop.id})" src="/img/icons/settings.png" height="20" width="20" align="right")

								div.row
									center
										canvas(height="300" width="450" id="#{prop.id}")

									p(style="margin: 15px;") This graph is showing data from #{prop.start} to #{prop.end}
							p &nbsp;

block settings
	div(style="display:none;")#updatesettings
		div(style="position: fixed; bottom: 200px; height: 50px; width: 100%; background-color: #6B2967;")
			div.row
				div.medium-3.columns
					button(align="center" onclick="updateGraph();" class="button tiny" style="margin-top : 8px;") Update
				div.medium-6.columns					
					h3(align="center" style="color: #FFFFFF;") Update Graph <span id="update_title"> </span>
				div.medium-3.columns
					img(src="/img/icons/close.png" height="20" width="20" align="right" style="margin-top: 15px; margin-right: 5px;" onclick="closeSettings()")#settings_button_close

		div(style="position: fixed; bottom: 0; height: 200px; width: 100%; background-color: #E9D9FA;")
			p &nbsp;

			div.row
				div.small-6.columns
					div.row(style="margin-bottom: 20px;")
						div.small-6.columns
							div.small-4.columns
								label(for="right-label" class="right inline") x axis
							div.medium-8.columns
								select#update_xaxis
									option(value="name") Name
									option(value="iteration") Iteration
						div.small-6.columns
							div.small-4.columns
								label(for="right-label" class="right inline") y axis
							div.medium-8.columns
								select#update_yaxis
									option(value="dropoff") Dropoff
									option(value="improvement") Improvement

							

				div.small-6.columns
					div.row
						div.small-4.columns
							label(for="right-label" class="right inline") Start Date
						div.medium-8.columns
							div.small-6.columns
								select##update_startmonth
									option(value="January") January
									option(value="Febuary") Febuary
									option(value="March") March
									option(value="May") May
									option(value="June") June
									option(value="July") July
									option(value="August") August
									option(value="September") September
									option(value="October") October
									option(value="November") November
									option(value="December") December
							div.medium-6.columns
									select#update_startyear
										option(value="2014") 2014
										option(value="2013") 2013
										option(value="2012") 2012
										option(value="2011") 2011

					div.row
						div.small-4.columns
							label(for="right-label" class="right inline") End Date
						div.medium-8.columns
							div.small-6.columns
								select#update_endmonth
									option(value="January") January
									option(value="Febuary") Febuary
									option(value="March") March
									option(value="May") May
									option(value="June") June
									option(value="July") July
									option(value="August") August
									option(value="September") September
									option(value="October") October
									option(value="November") November
									option(value="December") December
							div.medium-6.columns
									select#update_endyear
										option(value="2014") 2014
										option(value="2013") 2013
										option(value="2012") 2012
										option(value="2011") 2011

	script.
		var graphId = "";

		var chartsData = [];
		var stage = 1;
		var lastStage = 5;
		var options = {};

		//Set end and start date
		$("#finalNext").click(function() {
			options.startmonth = $('#startmonth').val();
			options.startyear = $('#startyear').val();
			options.endmonth = $('#endmonth').val();
			options.endyear = $('#endyear').val();

			options.xaxis = $('#xaxis').val();
			options.yaxis = $('#yaxis').val();
			options.variable = $('#kpi_variable').val();

			console.log(options);

			//set the summary page
			$('#s_start').text(options.startmonth + " " + options.startyear);
			$('#s_end').text(options.endmonth + " " + options.endyear);
			$('#s_topic').text(options.topic);
			$('#s_graph').text(options.graph);
			$('#s_x').text(options.xaxis);
			$('#s_y').text(options.yaxis);
			$('#s_v').text(options.variable);

		});

		//changes Options for when picking either KPI or any other field
		function onSelectTopics(id){
			console.log('selectTopic');

			//find topic chosen
			var topic = $('#' + id).val();
			options.topic = topic;

			//format next pages options
			if(topic == "kpi"){
				console.log("kpi - " + topic);

				//show only kpi variables and summary				
				$("#kpi_variableDisplay").attr("style", "display: ;");
				$("#xaxisDisplay").attr("style", "display: none;");
				$("#yaxisDisplay").attr("style", "display: none;");

				$('#variabledisplay').attr("style", "display: ;");
				$('#xydisplay').attr("style", "display: none;");
				

				//number and pie
				$("#barChart").css("display", "none");
				$("#lineChart").css("display", "none");
				$("#pieChart").css("display", "");
				$("#numberChart").css("display", "");
			}
			else {
				console.log("other - " + topic);

				//Bar and line
				$("#barChart").css("display", "visible");
				$("#lineChart").css("display", "visible");
				$("#pieChart").css("display", "none");
				$("#numberChart").css("display", "none");

				//show x and y axis
				$("#kpi_variableDisplay").attr("style", "display: none;");
				$("#xaxisDisplay").attr("style", "display: ;");
				$("#yaxisDisplay").attr("style", "display: ;");

				$('#variabledisplay').attr("style", "display: none;");
				$('#xydisplay').attr("style", "display: ;");
			}

			//clear out any old options
			$('#xaxis').find('option').remove().end();
			$('#yaxis').find('option').remove().end();



			switch(topic){
						case 'purchases':
							console.log('purchases');
							$('#xaxis').append($('<option/>', { value: 'name', text : 'Name' }));
							$('#yaxis').append($('<option/>', { value: 'amount', text : 'Amount' }));
							$('#yaxis').append($('<option/>', { value: 'percenttotal', text : '% of Total' }));


							break;

						case 'kpi':
							$('#kpi_variable').append($('<option/>', { value: 'totalusers', text : 'Total Users'}));
							$('#kpi_variable').append($('<option/>', { value: 'totalinstalls', text : 'Total Installs'}));
							$('#kpi_variable').append($('<option/>', { value: 'no_bounce', text : '# of Users who bounce'}));
							$('#kpi_variable').append($('<option/>', { value: 'no_onesess', text : '# of Users who only have one session'}));
							$('#kpi_variable').append($('<option/>', { value: 'gender', text : 'Gender'}));
							$('#kpi_variable').append($('<option/>', { value: 'play_session', text : 'Game Play/session'}));
							$('#kpi_variable').append($('<option/>', { value: 'duration', text : 'Average Session Duration'}));

							break;

						case 'activities':
							$('#xaxis').append($('<option/>', { value: 'name', text : 'Name' }));
							$('#xaxis').append($('<option/>', { value: 'iteration', text : 'Iteration' }));
							$('#yaxis').append($('<option/>', { value: 'dropoff', text : 'Drop Off' }));
							$('#yaxis').append($('<option/>', { value: 'improvement', text : 'Improvement' }));

							break;

						case 'actions':
							$('#xaxis').append($('<option/>', { value: 'name', text : 'Name' }));
							$('#xaxis').append($('<option/>', { value: 'iteration', text : 'Iteration' }));
							$('#yaxis').append($('<option/>', { value: 'dropoff', text : 'Drop Off' }));
							$('#yaxis').append($('<option/>', { value: 'improvement', text : 'Improvement' }));

							break;


			}
		}

		//When selecting a graph sets boarder and logs it in options
		function setGraph(type, id){
			//clear all
			$('#lineChart').css('border-style', 'none');
			$('#barChart').css('border-style', 'none');
			$('#pieChart').css('border-style', 'none');
			$('#numberChart').css('border-style', 'none');

			$('#' + id).css("border-style" , "solid");
			options.graph = type;
			console.log(options.graph)
		}

		$("#settings_button").click(function() {
			$("#settings_box").slideDown("slow");
		});

		function nextSettings(){


			if(stage < lastStage){
				currentStage = stage;
				stage++;

				$("#settings_p" + currentStage).slideUp("slow", function() {
					$("#settings_p" + stage).slideDown("slow");
				});
			}
		}

		function prevSettings(){
			if(stage > 1){
				currentStage = stage;
				stage--;

				$("#settings_p" + currentStage).slideUp("slow", function() {
					$("#settings_p" + stage).slideDown("slow");
				});
			}
		}

		$("#settings_button_close").click(function() {
			$("#settings_box").slideUp("slow");
		});

		/* * * 
		*	UPDATE SETTINGS CODE
		* * */

		function closeSettings() {
			$("#updatesettings").slideUp("fast");
		}

		function settings(id){
			//get data from AJAX call
			

			//set data in settings fields.
			console.log(id);
			graphId = id;
			$("#updatesettings").slideDown("fast");
		}

		function updateGraph() {
			alert('yyoyo');
		}

		/* * * 
		*	GRAPH GENERATION CODE
		* * */

		var length = !{JSON.stringify(charts)}.length
		for(var i = 0; i < length ; i++){

			chartsData.push(!{JSON.stringify(properties)}[i]);

			switch(!{JSON.stringify(properties)}[i].type){
				case 'pie':
					//Doughnut Chart
					var doughnutData = !{JSON.stringify(charts)}[i]
					var myDoughnut = new Chart(document.getElementById(!{JSON.stringify(properties)}[i].id).getContext("2d")).Doughnut(doughnutData);
					break;

				case 'line':
					//Line Graph
					var lineChartData = !{JSON.stringify(charts)}[i]
					var myLine = new Chart(document.getElementById(!{JSON.stringify(properties)}[i].id).getContext("2d")).Line(lineChartData);
					break;

				case 'bar':
					//BarChart
					var barChartData = !{JSON.stringify(charts)}[i]
					var myLine = new Chart(document.getElementById(!{JSON.stringify(properties)}[i].id).getContext("2d")).Bar(barChartData);
					break;

			}
		}

		console.log(chartsData);




	
